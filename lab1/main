import numpy as np
from Array import Arr
import pandas as pd

class Clustering:
    def __init__(self, values):
        self.values = values
        self.n = values.shape[0]
        self.clusters = {i: [i] for i in range(self.n)}
        self.dist_matrix = self._calculate_initial_distances()

    def _cluster_distance(self, a, b):
        return np.sqrt(np.sum((a - b) ** 2))

    def _calculate_initial_distances(self):
        n = self.n
        dist_matrix = np.zeros((n, n))
        for i in range(n):
            for j in range(i+1, n):
                dist = self._cluster_distance(self.values[i], self.values[j])
                dist_matrix[i, j] = dist
                dist_matrix[j, i] = dist
        return dist_matrix

    def find_closest_clusters(self):
        min_val = np.inf
        c1, c2 = -1, -1
        for i in self.clusters.keys():
            for j in self.clusters.keys():
                if i < j and self.dist_matrix[i, j] < min_val:
                    min_val = self.dist_matrix[i, j]
                    c1, c2 = i, j
        return c1, c2, min_val

    def merge_clusters(self, c1, c2):
        new_index = max(self.clusters.keys()) + 1
        self.clusters[new_index] = self.clusters[c1] + self.clusters[c2]
        del self.clusters[c1]
        del self.clusters[c2]

    def run(self):
        while len(self.clusters) > 1:
            c1, c2, dist = self.find_closest_clusters()
            print(f"Merging clusters {c1} and {c2} (distance = {dist:.3f})")
            self.merge_clusters(c1, c2)
            print("Current clusters:", self.clusters)
            print("Distance matrix:\n", self.dist_matrix)

if __name__ == "__main__":
    array = Arr()
    array.input_values()
    array.print_values()

    clustering = Clustering(array._values)
    clustering.run()
